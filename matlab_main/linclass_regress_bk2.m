close all;
clear all;

% Тренировочная выборка
M = dlmread('train.csv',';',1,0);
n_params = length(M(1,:));
Y = M(:, n_params);
n = length(Y);
I = [ones(n,1), M(:, 1:1:n_params-1)];
n_params = length(I(1,:));

% Инициализация параметров системы
n_traintest = 1000; % кол-во примеров из тренировочной выборки для теста

for p = 2:1:n_params 
    %I(:,p) = ((I(:,p) - min(I(:,p)))/(max(I(:,p)) - min(I(:,p))))*12 - 1;
    I(:,p) = I(:,p)/max(I(:,p));
end;


%theta = [-9.18139553, 39.28541183, 83.78191376, 34.51664734, 174.60638428,-10.73946476, 4.93131685, 1.77164125,-42.80970764, 129.59159851, 114.19770813,-138.40643311, 29.11778069]
%theta = [-8.44290924, 29.78118134, 80.25679779, 40.72060776, 174.38059998,-21.52545738, 7.88039351, 2.39611602,-12.62925339, 152.70379639, 138.65490723,-186.36206055, 32.03093719]
theta = [3.63284041295152 10.2896423728188 -2.48544946877048 4.92537889825996 104.195104226131 88.8950844088433 -77.1414169433037 -15.6985109401622 10.6509842555642 -29.1151152474765 -2.78389281118004 5.08640538514940 -46.9858765733293 -31.4893717351914 -3.65988831378206 -17.7443169870069 -9.46988069452986 -52.2001635374701 3.80670657066382 -3.63985465577297 79.4975421187212 31.4514697094461 -26.2407174701231 -19.1570733507320 -10.0827361314266 -3.56153443119181 -3.48677576057485 2.73908185572881 -0.794509908588670 -0.983270277017804 3.22919660552027 15.5903403848003 4.74040853269569 -19.8841509378388 -4.92472651367614 -31.0252579387420 -27.3006491558390 15.2382450566647 18.3142696279540 -2.43055499320206 -14.7270262511118 0.0498553136305197 10.4908266910151 29.7999923822691 4.58163746912342 -3.55166276035260 -24.0275576630807 -37.0620328624348 -84.5373617756750 -90.4626233863643 -96.2785756194842 -97.3814994652076 -88.3489126680515 -55.0509842938629 21.3558915815718 95.5220467983018 13.2964037251493 -15.6729145548395 -1.39654422687654 20.0949137745030 16.7554376013083 7.53829990705007 12.3780421853887 48.3725479730135 138.204257717134 122.739152896687 62.7499871184185 18.1950485986421 -7.40693089620062 -23.8239906618810 -37.2925288957920]
% тестирование
error_test_avrg = 0;
error_train_avrg = 0;
% тестирование на тренировочной выборке
for t = 1:n-n_traintest
    error_train_avrg = error_train_avrg + ((sum(I(t,:).*theta) - Y(t))^2)/(n-n_traintest)/2; % Подсчет ошибки\
end;
for t = n-n_traintest+1:1:n
    error_test_avrg = error_test_avrg + ((sum(I(t,:).*theta) - Y(t))^2)/(n_traintest)/2; % Подсчет ошибки\
end;
display(error_test_avrg);
display(error_train_avrg);

res = zeros(3,n_traintest);
for t = n-n_traintest+1:1:n
    res(1,t - n+n_traintest) = Y(t);
    res(2,t - n+n_traintest) = round(sum(I(t,:).*theta));
    res(3,t - n+n_traintest) = round(sum(I(t,:).*theta))-Y(t);
end;

% 
for p = 2:1:13
    figure(p)
    yy = zeros(1,1000);
    yyn = zeros(1,1000);
    for i = 1:1:n
        yy(Y(i)) = yy(Y(i)) + I(i,p);
        yyn(Y(i)) = yy(Y(i)) + 1;
    end;
    hold on
    plot(1:1000, yy./yyn)
    plot(1:1000, -((1:1000)./1000).^2+1./(((1:1000)+10))+0.9)
end;
